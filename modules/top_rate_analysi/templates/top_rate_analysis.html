<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주식분석 - 등락율상위분석</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('top_rate.static', filename='css/top_rate_analysis.css') }}" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 좌측 사이드바 -->
        <nav class="sidebar">
            <div class="logo-section">
                <div class="logo">📊 Stock Analyzer</div>
                <div class="subtitle">Professional Edition</div>
            </div>

            <div class="nav-section">
                <div class="nav-group">
                    <div class="nav-title">분석 카테고리</div>
                    <a href="{{ url_for('top_rate.index') }}" class="nav-item active">
                        <i class="fas fa-chart-line"></i>
                        등락율상위
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-robot"></i>
                        AI 분석
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-chart-bar"></i>
                        차트 분석
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-balance-scale"></i>
                        수급 분석
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-title">설정</div>
                    <a href="#" class="nav-item">
                        <i class="fas fa-database"></i>
                        종목 설정
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-clock"></i>
                        스케줄링
                    </a>
                    <a href="#" class="nav-item">
                        <i class="fas fa-cog"></i>
                        시스템 설정
                    </a>
                </div>
            </div>
        </nav>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <header class="header">
                <h1 class="page-title">
                    <i class="fas fa-chart-line"></i>
                    등락율상위분석
                </h1>
                <div class="date-selector">
                    <input type="date" class="date-input" id="analysisDate" value="{{ current_trading_date }}">
                </div>
            </header>

            <!-- 컨트롤 패널 -->
            <section class="control-panel">
                <!-- 데이터 수집 카드 -->
                <div class="data-collection-card">
                    <h3 class="card-title">
                        <i class="fas fa-download"></i>
                        당일 데이터 수집
                    </h3>

                    <div class="collection-buttons">
                        <button class="btn btn-primary" id="collectDataBtn">
                            <i class="fas fa-play"></i>
                            데이터 수집 시작
                        </button>
                        <button class="btn btn-success hidden" id="analyzeBtn">
                            <i class="fas fa-brain"></i>
                            분석 실행
                        </button>
                    </div>

                    <!-- 진행상황 -->
                    <div class="progress-section hidden" id="progressSection">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progressText">대기 중...</span>
                            <span id="progressPercent">0%</span>
                        </div>

                        <div class="log-container" id="logContainer">
                            <div class="log-entry">시스템 준비 완료. 수집을 시작하려면 버튼을 클릭하세요.</div>
                        </div>
                    </div>
                </div>

                <!-- 스케줄 설정 카드 -->
                <div class="schedule-card">
                    <h3 class="card-title">
                        <i class="fas fa-clock"></i>
                        자동 스케줄
                    </h3>

                    <div class="schedule-item">
                        <span class="schedule-time">오전 09:15</span>
                        <div class="schedule-toggle active" data-time="09:15"></div>
                    </div>

                    <div class="schedule-item">
                        <span class="schedule-time">오후 02:00</span>
                        <div class="schedule-toggle" data-time="14:00"></div>
                    </div>

                    <div class="schedule-item">
                        <span class="schedule-time">오후 05:30</span>
                        <div class="schedule-toggle" data-time="17:30"></div>
                    </div>
                </div>
            </section>

            <!-- 분석 결과 영역 -->
            <section class="analysis-section">
                <div class="analysis-header">
                    <h2 class="analysis-title">
                        <i class="fas fa-chart-pie"></i>
                        테마별 분석 결과
                    </h2>
                </div>

                <div class="theme-grid" id="themeGrid">
                    <!-- 테마 카드들이 여기에 동적으로 추가됩니다 -->
                </div>
            </section>
        </main>
    </div>

    <!-- 테마 상세정보 모달 -->
    <div class="modal" id="themeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">
                    <i class="theme-icon" id="modalIcon"></i>
                    테마 상세분석
                </h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>

            <div class="modal-body">
                <div class="stock-list" id="modalStockList">
                    <!-- 종목 리스트가 여기에 추가됩니다 -->
                </div>

                <div class="news-section">
                    <h4 style="margin-bottom: 15px; color: #1a365d;">📰 주요 뉴스</h4>
                    <div id="modalNewsList">
                        <!-- 뉴스 리스트가 여기에 추가됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('top_rate.static', filename='js/top_rate_analysis.js') }}"></script>
    <script>
        // 서버에서 전달된 데이터
        window.APP_CONFIG = {
            apiPrefix: '{{ api_prefix }}',
            currentDate: '{{ current_trading_date }}',
            availableDates: {{ available_dates | tojson }},
            moduleName: '{{ module_name }}',
            moduleVersion: '{{ module_version }}'
        };

        // 앱 초기화
        document.addEventListener('DOMContentLoaded', function() {
            TopRateAnalysis.init();
        });
    </script>
</body>
</html>